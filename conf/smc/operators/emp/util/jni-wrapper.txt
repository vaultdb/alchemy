package org.smcql.compiler.emp.generated;


import java.nio.ByteBuffer;

import org.bytedeco.javacpp.BoolPointer;
import org.bytedeco.javacpp.Loader;
import org.bytedeco.javacpp.Pointer;
import org.bytedeco.javacpp.annotation.ByPtr;
import org.bytedeco.javacpp.annotation.Namespace;
import org.bytedeco.javacpp.annotation.Platform;


import org.smcql.compiler.emp.EmpProgram;
import org.smcql.compiler.emp.EmpParty;


@Platform(include={"$queryName.h"}, 
			compiler = "cpp11")





@Namespace("$queryName")
public class $queryName  extends EmpProgram  {


	
	public $queryName(int party, int port) {
		super(party, port);
	}

	public static class $queryClass extends Pointer {
	
        static {
        
         
			Loader.load(); 
	       } 
       
        public $queryClass() { 	
        	allocate(); 
        	}
        private native void allocate();

        public native void run(int party, int port); 
        public native @ByPtr BoolPointer getOutput();
        
        
	}
	
	   boolean[] queryOutput = null;
	   
	   @Override
	   public String helloWorld() {
    		return "I am a $queryName!";
    	}
	   
	   	
        @Override
        public  boolean[] runProgram() {
        	$queryClass theQuery = new $queryClass();

        	System.out.println("Running $queryName with object " + theQuery + " of type " + theQuery.getClass());        	
	        theQuery.run(party.asInt(), party.getPort());

		    System.out.println("Done running emp!");	        
	        BoolPointer outputPtr = theQuery.getOutput();
	        ByteBuffer buf = outputPtr.asByteBuffer();
	        
	        // copy bytes out of buffer
	        byte[] bytes = new byte[buf.capacity()];    
	        buf.get(bytes, 0, bytes.length);
	        
	        theQuery.close();
	        
	       return byteArray2BitArray(bytes);
	        
        }
        
	// for testing
	public static void main(String[] args) {
           int party = Integer.parseInt(args[0]);
	       int port = Integer.parseInt(args[1]);
		
		$queryName qc = new $queryName(party, port);
		qc.runProgram();
	
	        
    }        
	
    	
}
